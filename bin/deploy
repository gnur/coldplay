#!/bin/bash
#
function log {
  echo "$(hostname): $(date +%T)> $*"
}

ssh coldplay "sudo systemctl stop yellow"


log "building yellow (go)"
GOOS=linux GOARCH=arm go build -o yellow .

upx yellow

log "copying binaries"
scp yellow coldplay:/home/erwin/bin/yellow

scp systemd/yellow.service coldplay:/tmp/yellow.service
ssh coldplay "chmod +x /home/erwin/bin/yellow; sudo cp /tmp/yellow.service /etc/systemd/system/yellow.service; sudo systemctl daemon-reload"


log "starting systemd yellow"
ssh coldplay "sudo systemctl start yellow"

ssh coldplay "sudo journalctl -u yellow -f"
