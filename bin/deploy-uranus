#!/bin/bash

cd go

function log {
  echo "$(date +%T) $*"

}


log "Building binary"
GOARCH=amd64 GOOS=linux go build -o coldplay main.go

log "compressing binary"
upx coldplay

log "Stopping service and copying new binary"
ssh uranus "sudo /usr/bin/systemctl stop coldplay"
rsync -a coldplay uranus:/home/erwin/bin/coldplay
ssh uranus "sudo /usr/bin/systemctl start coldplay"

log "Tailing logs"
ssh uranus "journalctl -u coldplay -f"
